<html>
<head>
	<title>swtblupt: home</title>
	<style>
		
		.header-title {
			color:#4d4d4d;
		}

		.outer-div {
			padding: 30px;
		}

		.inner-div {
			width: 1000px;
			margin: auto;
		}

		#mapid { 
			height: 600px;
			width: 1000px;
			margin: auto;
		}

		#query-former {
			height: 300px;
			width: 700px;
			margin: auto;
			text-align: center;
			background-color: #b3b3b3;
		}

		#sql-query-div {
			height: 20px;
			width: 700px;
			margin: auto;
			text-align: center;
			color: red;
		}

		#test-div {
			width: 200px;
			margin: auto;
		}

	</style>
	 
	<!-- leaflet stuff -->
	 <link rel="stylesheet" href="https://unpkg.com/leaflet@1.3.4/dist/leaflet.css" integrity="sha512-puBpdR0798OZvTTbP4A8Ix/l+A4dHDD0DGqYW6RQ+9jxkRFclaxxQb/SJAWZfWAkuyeQUytO7+7N4QKrDh+drA==" crossorigin=""/>
	  <!-- Make sure you put this AFTER Leaflet's CSS -->
 <script src="https://unpkg.com/leaflet@1.3.4/dist/leaflet.js" integrity="sha512-nMMmRyTVoLYqjP9hrbed9S+FzjZHW5gY1TWCHA5ckwXZBadntCNs8kEqAWdrb9O7rxbCaA4lKTIWjDXZxflOcA==" crossorigin=""></script>
 <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.9.0/jquery.min.js"></script>
 <!-- leaflet omnivore: https://www.mapbox.com/mapbox.js/plugins/#leaflet-omnivore -->
 <script src='https://api.mapbox.com/mapbox.js/v3.1.1/mapbox.js'></script>
 <script src='https://api.mapbox.com/mapbox.js/plugins/leaflet-omnivore/v0.2.0/leaflet-omnivore.min.js'></script>

</head>
<body style="background-color:#efefef;">
	
	<!-- div containing the title at the top of the page -->
	<div style="text-align:center;" class="header-title">
		<h1>State-Wide Transit-Based Land Use Policy Tool</h1>
		<h2>(S.W.T.B.L.U.P.T.)</h2>
		<h3><i>swet-bloopt</i></h3>
	</div>
	
	<!-- this div is where I will show the data from the PostgreSQL database, if it loads -->
	<div class="outer-div">
		<div id="test-div"> ~~ test data test data ~~ </div>
	</div>
	<!--div containing the map -->
	 <div class="outer-div"><div id="mapid"></div></div>
	 

	 <!--Interactive area where stops are toggled // SQL query is generated -->

	 <div class="outer-div">
	 	<div id="query-former">
		 	<br>
		 	<h2>Select headways</h2>
		 	<br>
		 	<form name="am_peak">
		 	<b>AM Peak Period (6AM-10AM):</b>
				<input type="radio" name="am_peak" value="10"> 10 min
	  			<input type="radio" name="am_peak" value="15"> 15 min
	  			<input type="radio" name="am_peak" value="20"> 20 min  
			</form>
			<form>
			<b>PM Peak Period (3PM-7PM):</b>
				<input type="radio" name="pm_peak" value="10"> 10 min
	  			<input type="radio" name="pm_peak" value="15"> 15 min
	  			<input type="radio" name="pm_peak" value="20"> 20 min  
			</form>
			<form>
		 	<b>Weekday (6AM-10PM):</b>
				<input type="radio" name="weekday" value="10"> 10 min
	  			<input type="radio" name="weekday" value="15"> 15 min
	  			<input type="radio" name="weekday" value="20"> 20 min  
			</form>
			<form>
			<b>Saturday (8AM-10PM):</b>
				<input type="radio" name="saturday" value="ignore"> Ignore Saturday Headways
				<input type="radio" name="saturday" value="15"> 15 min
	  			<input type="radio" name="saturday" value="20"> 20 min
	  			<input type="radio" name="saturday" value="30"> 30 min  
			</form>
			<form>
			<b>Sunday (8AM-10PM):</b>
				<input type="radio" name="sunday" value="ignore"> Ignore Sunday Headways
				<input type="radio" name="sunday" value="15"> 15 min
	  			<input type="radio" name="sunday" value="20"> 20 min
	  			<input type="radio" name="sunday" value="30"> 30 min 
	  		</form>
	  		<button onclick="generateQuery()">Generate SQL query</button>
	 	</div>
	 </div>


	 <!-- test div to reveal SQL query -->
	 <div class="outer-div">
	 	<div id="sql-query-div">
	 		<p id="sql-query">example SQL query here</p>
	 	</div>
	 </div>


 	 <div class="outer-div">
     <div class="inner-div">
 		<button onclick="buildPage()">load data</button>
 	 </div>
     </div>


	 <div class="outer-div">
	 	<div class="inner-div">simon hochberg | <a href="mailto:simon_hochberg@berkeley.edu">email</a> | <a href="https://github.com/simonhochberg/swtblupt">github</a></div>
	 </div>

<script type="text/javascript">
	
	var mymap = L.map('mapid').setView([34.0522, -118.2437], 11);

	L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token={accessToken}', {
    attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors, <a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery Â© <a href="https://www.mapbox.com/">Mapbox</a>',
    maxZoom: 18,
    id: 'mapbox.streets',
    accessToken: 'pk.eyJ1Ijoic2ltb25ob2NoYmVyZyIsImEiOiIwYVZ1Uk1VIn0.EcS4Ld8UB_UDeqJqJqQIyg'
}).addTo(mymap);

// var marker = L.marker([34.0522, -118.2437]).addTo(mymap);
// marker.bindPopup("<b>Hello world!</b><br>I am a popup.");

	// testing adding a polygon 
	/*
	var latlngs = [
  		[ // first polygon
		    [[37, -109.05],[41, -109.03],[41, -102.05],[37, -102.04]], // outer ring
		    [[37.29, -108.58],[40.71, -108.58],[40.71, -102.50],[37.29, -102.50]] // hole
  		],
		[ // second polygon
		   	[[41, -111.03],[45, -111.04],[45, -104.05],[41, -104.05]]
		  ]
];
	var polygon = L.polygon(latlngs, {color: 'yellow'}).addTo(mymap); */
	
	var testPoly = "MULTIPOLYGON (((-118.4858305088884 34.013884, -118.4858515443671 34.01345581299368, -118.4859144482201 34.0130317496623, -118.486018614649 34.01261589396757, -118.486163040474 34.01221225082714, -118.4863463347955 34.01182470754512, -118.4865667323891 34.01145699637517, -118.4868221107053 34.01111265857685, -118.4871100103114 34.01079501031141, -118.4874276585769 34.01050711070528, -118.4877719963752 34.01025173238907, -118.4881397075451 34.01003133479553, -118.4885272508271 34.009848040474, -118.4889308939676 34.00970361464899, -118.4893467496623 34.00959944822014, -118.4897708129937 34.0095365443671, -118.490199 34.00951550888837, -118.4906271870063 34.0095365443671, -118.4910512503377 34.00959944822014, -118.4914671060324 34.00970361464899, -118.4918707491729 34.009848040474, -118.4922582924549 34.01003133479553, -118.4926260036248 34.01025173238907, -118.4929703414231 34.01050711070528, -118.4932879896886 34.01079501031141, -118.4935758892947 34.01111265857685, -118.4938312676109 34.01145699637517, -118.4940516652045 34.01182470754512, -118.494234959526 34.01221225082714, -118.494379385351 34.01261589396757, -118.4944835517799 34.0130317496623, -118.4945464556329 34.01345581299368, -118.4945674911116 34.013884, -118.4945464556329 34.01431218700631, -118.4944835517799 34.01473625033769, -118.494379385351 34.01515210603242, -118.494234959526 34.01555574917285, -118.4940516652045 34.01594329245487, -118.4938312676109 34.01631100362483, -118.4935758892947 34.01665534142315, -118.4932879896886 34.01697298968858, -118.4929703414231 34.01726088929471, -118.4926260036248 34.01751626761093, -118.4922582924549 34.01773666520446, -118.4918707491729 34.01791995952599, -118.4914671060324 34.018064385351, -118.4910512503377 34.01816855177986, -118.4906271870063 34.01823145563289, -118.490199 34.01825249111162, -118.4897708129937 34.01823145563289, -118.4893467496623 34.01816855177986, -118.4889308939676 34.018064385351, -118.4885272508271 34.01791995952599, -118.4881397075451 34.01773666520446, -118.4877719963752 34.01751626761093, -118.4874276585769 34.01726088929471, -118.4871100103114 34.01697298968858, -118.4868221107053 34.01665534142315, -118.4865667323891 34.01631100362483, -118.4863463347955 34.01594329245487, -118.486163040474 34.01555574917285, -118.486018614649 34.01515210603242, -118.4859144482201 34.01473625033769, -118.4858515443671 34.01431218700631, -118.4858305088884 34.013884)), ((-118.3488926050777 34.07024, -118.3489136545391 34.06981152837047, -118.3489766002054 34.06938718315695, -118.3490808358754 34.06897105103582, -118.3492253577027 34.06856713958691, -118.3494087738631 34.06817933869824, -118.3496293179587 34.06781138310439, -118.3498848660293 34.06746681641886, -118.3501729570072 34.06714895700719, -118.3504908164189 34.06686086602928, -118.3508353831044 34.06660531795873, -118.3512033386982 34.06638477386316, -118.3515911395869 34.06620135770276, -118.3519950510358 34.06605683587543, -118.3524111831569 34.06595260020537, -118.3528355283705 34.06588965453907, -118.353264 34.0658686050777, -118.3536924716295 34.06588965453907, -118.354116816843 34.06595260020537, -118.3545329489642 34.06605683587543, -118.3549368604131 34.06620135770276, -118.3553246613018 34.06638477386316, -118.3556926168956 34.06660531795873, -118.3560371835811 34.06686086602928, -118.3563550429928 34.06714895700719, -118.3566431339707 34.06746681641886, -118.3568986820413 34.06781138310439, -118.3571192261368 34.06817933869824, -118.3573026422972 34.06856713958691, -118.3574471641246 34.06897105103582, -118.3575513997946 34.06938718315695, -118.3576143454609 34.06981152837047, -118.3576353949223 34.07024, -118.3576143454609 34.07066847162953, -118.3575513997946 34.07109281684305, -118.3574471641246 34.07150894896417, -118.3573026422972 34.07191286041309, -118.3571192261368 34.07230066130175, -118.3568986820413 34.0726686168956, -118.3566431339707 34.07301318358113, -118.3563550429928 34.07333104299281, -118.3560371835811 34.07361913397072, -118.3556926168956 34.07387468204126, -118.3553246613018 34.07409522613684, -118.3549368604131 34.07427864229724, -118.3545329489642 34.07442316412457, -118.354116816843 34.07452739979463, -118.3536924716295 34.07459034546093, -118.353264 34.0746113949223, -118.3528355283705 34.07459034546093, -118.3524111831569 34.07452739979463, -118.3519950510358 34.07442316412457, -118.3515911395869 34.07427864229724, -118.3512033386982 34.07409522613684, -118.3508353831044 34.07387468204126, -118.3504908164189 34.07361913397072, -118.3501729570072 34.07333104299281, -118.3498848660293 34.07301318358113, -118.3496293179587 34.0726686168956, -118.3494087738631 34.07230066130175, -118.3492253577027 34.07191286041309, -118.3490808358754 34.07150894896417, -118.3489766002054 34.07109281684305, -118.3489136545391 34.07066847162953, -118.3488926050777 34.07024)))";

	var testGeo = omnivore.wkt.parse(testPoly);
	
	numOfShapes = Object.keys(testGeo['_layers']).length;
	
	//console.log(numOfShapes);
	
	var i;
	var j;

	for (i = 0; i < numOfShapes; i++) { 
    	lyr = Object.keys(testGeo['_layers'])[i];
    	for (j = 0; j < 2; j++){
    		var geom = testGeo['_layers'][lyr]["_latlngs"][j];
    		var testGeoOnMap = L.polygon(geom, {color:'red'}).addTo(mymap);
    		//console.log(j, geom);
    	}
    }

	// console.log(testGeo);

	// console.log(Object.keys(testGeo['_layers']));

	// var geom = testGeo._layers[67]._latlngs[0];
	
	// console.log(geom);

	// var testGeoOnMap = L.polygon(geom, {color:'red'}).addTo(mymap);


	// zoom the map to the polygon
	// mymap.fitBounds(polygon.getBounds());
	
function generateQuery() {
  	// sun = document.getElementsByTagName('am_peak').value;
  	var am_peak = document.querySelector('input[name="am_peak"]:checked').value;
  	var pm_peak = document.querySelector('input[name="pm_peak"]:checked').value;
  	var wkdy = document.querySelector('input[name="weekday"]:checked').value;
  	var sat = document.querySelector('input[name="saturday"]:checked').value;
  	var sun = document.querySelector('input[name="sunday"]:checked').value;

  	// generate the SQL query to be passed to the PostgreSQL to return eligible stops

  	txt = "SELECT * FROM lametro WHERE ";
  	txt += "(am_pk_dir0 <= " + am_peak + " OR am_pk_dir1 <= " + am_peak + ")";
  	txt += " AND (pm_pk_dir0 <= " + pm_peak + " OR pm_pk_dir1 <= " + pm_peak + ")";
  	txt += " AND (wkdy_dir0 <= " + wkdy + " OR wkdy_dir1 <= " + wkdy + ")";
  	
  	if (sat != "ignore"){
  		txt += " AND (sat_dir0 <= " + sat + " OR sat_dir1 <= " + sat + ")";
  	}
  	else {

  	}

  	if (sun != "ignore") {
		txt += " AND (sun_dir0 <= " + sun + " OR sun_dir1 <= " + sun + ")";
  	}
  	else{

  	}
  	
  	txt += ";"

	document.getElementById("sql-query").innerHTML = txt;
}

// FROM SFMTA ELEVATOR FEED

function buildPage() {
    $('#test-div').load('data.php', function(response,status,xhr){
        //console.log(response);
        if(status == 'success') {
            myObj = JSON.parse(response);
            console.log(myObj);
        }
	}
	)
};

</script>

</body>
</html>
